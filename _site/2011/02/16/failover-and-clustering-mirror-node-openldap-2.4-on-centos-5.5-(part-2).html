<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta http-equiv="Content-Language" content="en"/>
    <title>Failover and Clustering Mirror Node OpenLdap 2.4 on Centos 5.5 (part 2)</title>
    <link rel="stylesheet" href="/style.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="/syntax.css" type="text/css" media="screen"/>
</head>

<script type="text/javascript">
        var disqus_awesome = ; 
        var disqus_developer = ;
</script>    

<body>
    <div class="outercolumn">
        <div class="topbar">
            <a href="/index.html">Home</a> - <a href="/archives/index.html">archive</a>
        </div>

        <div class="column">
            <div class="content">
                

<div class="title">
    Failover and Clustering Mirror Node OpenLdap 2.4 on Centos 5.5 (part 2)
</div>

<div class="date">
<!--    

    published: 16 Feb 2011,
    in category: <a href="/archives/FailoverCLusterMirrorNodeOpenldapCentOs.html">FailoverCLusterMirrorNodeOpenldapCentOs</a>
-->
    in category: 
<a rel="tag" href="/archives/Failover.html">Failover</a>, 

<a rel="tag" href="/archives/CLuster.html">CLuster</a>, 

<a rel="tag" href="/archives/Mirror.html">Mirror</a>, 

<a rel="tag" href="/archives/Node.html">Node</a>, 

<a rel="tag" href="/archives/Openldap.html">Openldap</a>, 

<a rel="tag" href="/archives/CentOs.html">CentOs</a>, 



</div>

<div class="innercontent">
    <h2 id='read_first'>READ FIRST</h2>
<a href='/2010/09/05/Clustering-Openldap-2.4-dengan-Mirror-Node-Replication-di-CentOs-5.5.html' target='_new'>Clustering Openldap 2.4 dengan Mirror Node Replication di Centos 5.5</a>
<h2 id='design_sistem'>Design Sistem:</h2>

<h3 id='ternate_19216811213__failover'>Ternate (192.168.11.213) = failover</h3>

<h3 id='halmahera_19216811215__node_failover'>Halmahera (192.168.11.215) = node failover</h3>

<h3 id='morotai_19216811216__node_failover'>Morotai (192.168.11.216) = node failover</h3>
<pre>
Ternate (Failover) ---- Halmahera (ldap) --| 
		   |                       | Mirroring
                   ---- Morotai (ldap)  ---|
</pre>
<h2 id='a_installasi'>A. Installasi</h2>

<h3 id='a1_barkeley_db_48'>A.1 Barkeley DB 4.8</h3>
<div class='highlight'><pre><code class='bash'><span class='c'># cd /usr/local/src/</span>
<span class='c'># wget -c http://download.oracle.com/berkeley-db/db-4.8.30.tar.gz</span>
<span class='c'># tar -xzvf db-4.8.30.tar.gz</span>
<span class='c'># cd db-4.8.30</span>
<span class='c'># cd build_unix</span>
<span class='c'># ../dist/configure --prefix=/usr/local/BerkeleyDB4.8.30</span>
<span class='c'># make clean</span>
<span class='c'># make</span>
<span class='c'># make install</span>
</code></pre>
</div>
<h3 id='a2_openldap_24'>A.2 openldap 2.4</h3>

<h4 id='a21_nonssl'>A.2.1 Non-ssl</h4>
<div class='highlight'><pre><code class='bash'><span class='c'># CPPFLAGS=&quot;-I/usr/local/BerkeleyDB4.8.30/include&quot;</span>
<span class='c'># export CPPFLAGS</span>
<span class='c'># LDFLAGS=&quot;-L/usr/local/lib -L/usr/local/BerkeleyDB4.8.30/lib -R/usr/local/BerkeleyDB4.8.30/lib&quot;</span>
<span class='c'># export LDFLAGS</span>
<span class='c'># LD_LIBRARY_PATH=&quot;/usr/local/BerkeleyDB4.8.30/lib&quot;</span>
<span class='c'># export LD_LIBRARY_PATH</span>
</code></pre>
</div><div class='highlight'><pre><code class='bash'><span class='c'># cd /usr/local/src/</span>
<span class='c'># wget -c ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/openldap-2.4.23.tgz</span>
<span class='c'># ./configure --prefix=/usr/local/openldap2.4</span>
<span class='c'># make depend</span>
<span class='c'># make</span>
<span class='c'># make install</span>
</code></pre>
</div>
<h4 id='a22_withopenssl'>A.2.2 with-Openssl</h4>

<p>Install openssl:</p>
<div class='highlight'><pre><code class='bash'><span class='c'># sudo wget -c http://www.openssl.org/source/openssl-1.0.0a.tar.gz</span>
<span class='c'># sudo tar -xzvf openssl-1.0.0a.tar.gz</span>
<span class='c'># cd openssl-1.0.0a</span>
<span class='c'># sudo ./config shared --prefix=/usr/local/openssl/</span>
</code></pre>
</div>
<p>Generate server.pem</p>
<div class='highlight'><pre><code class='bash'><span class='c'># cd /usr/local/openldap/ssl/;</span>
<span class='c'># openssl req -newkey rsa:1024 -x509 -nodes -out server.pem -keyout server.pem -days 3650</span>
</code></pre>
</div>
<h4 id='a23_install_openldap'>A.2.3 Install openldap</h4>
<div class='highlight'><pre><code class='bash'><span class='c'># CPPFLAGS=&quot;-I/usr/local/BerkeleyDB4.8.30/include -I/usr/local/openssl/include/&quot;</span>
<span class='c'># LDFLAGS=&quot;-L/usr/local/lib -L/usr/local/BerkeleyDB4.8.30/lib -R/usr/local/BerkeleyDB4.8.30/lib -L/usr/local/openssl/lib64/&quot;</span>
<span class='c'># LD_LIBRARY_PATH=&quot;/usr/local/BerkeleyDB4.8.30/lib&quot;</span>
<span class='c'># export CPPFLAGS</span>
<span class='c'># export LDFLAGS</span>
<span class='c'># export LD_LIBRARY_PATH</span>
</code></pre>
</div><div class='highlight'><pre><code class='bash'><span class='c'># cd /usr/local/src/</span>
<span class='c'># wget -c ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/openldap-2.4.23.tgz</span>
<span class='c'># ./configure --prefix=/usr/local/openldap --with-tls=openssl</span>
<span class='c'># make depend</span>
<span class='c'># make</span>
<span class='c'># make install</span>
</code></pre>
</div>
<h2 id='b_konfigurasi'>B. Konfigurasi</h2>

<h3 id='b1_file_conf'>B.1 File conf:</h3>

<h4 id='b11_nonssl'>B.1.1 Non-ssl</h4>
<div class='highlight'><pre><code class='bash'>/usr/local/openldap2.4/etc/openldap/slapd.conf
/usr/local/openldap2.4/etc/openldap/ldap.conf
</code></pre>
</div>
<h4 id='b12_withssl'>B.1.2 with-ssl</h4>
<div class='highlight'><pre><code class='bash'>/usr/local/openldap/etc/openldap/slapd.conf
/usr/local/openldap/etc/openldap/ldap.conf
</code></pre>
</div>
<p>add to all machine on slapd.conf:</p>
<div class='highlight'><pre><code class='bash'>TLSCipherSuite HIGH:MEDIUM:-SSLv2
TLSCACertificateFile /usr/local/openldap/ssl/server.pem
TLSCertificateFile /usr/local/openldap/ssl/server.pem
TLSCertificateKeyFile /usr/local/openldap/ssl/server.pem
</code></pre>
</div>
<h4 id='b13_nssswitch'>B.1.3 NSSswitch</h4>

<p>add ldap option on nsswitch.conf to all machine:</p>
<div class='highlight'><pre><code class='bash'>passwd:     files ldap
shadow:     files ldap
group:      files ldap
</code></pre>
</div>
<h3 id='b2_konfigurasi_master_failover'>B.2 Konfigurasi Master Failover</h3>

<p>TERNATE/192.168.11.213:</p>

<h4 id='b21_auth'>B.2.1 Auth</h4>

<h4 id='b22_etcldapconf'>B.2.2 /etc/ldap.conf:</h4>

<h1 id='begin'>Begin</h1>
<div class='highlight'><pre><code class='bash'>host  192.168.11.216 192.168.11.215
base <span class='nv'>dc</span><span class='o'>=</span>finnet-indonesia,dc<span class='o'>=</span>com
port 389
timelimit 5
bind_timelimit 2
bind_policy soft
idle_timelimit 3600
nss_initgroups_ignoreusers root,ldap,named,avahi,haldaemon,dbus,radvd,tomcat,radiusd,news,mailman,nscd,gdm,username,rudi
uri ldap://192.168.11.216/ ldap://192.168.11.215/
ssl no
tls_cacertdir /etc/openldap/cacerts
pam_password md5
</code></pre>
</div>
<h1 id='eof'>EOF</h1>

<h4 id='b23_pam'>B.2.3 PAM:</h4>
<div class='highlight'><pre><code class='bash'>/etc/pam.d/system-auth
<span class='c'>#%PAM-1.0</span>
<span class='c'># This file is auto-generated.</span>
<span class='c'># User changes will be destroyed the next time authconfig is run.</span>
auth        required      pam_env.so
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid &gt;<span class='o'>=</span> 500 quiet
auth        sufficient    pam_ldap.so use_first_pass
auth        required      pam_deny.so

account     required      pam_unix.so broken_shadow
account     sufficient    pam_localuser.so
account     sufficient    pam_succeed_if.so uid &lt; 500 quiet
account     <span class='nv'>default</span><span class='o'>=</span>bad <span class='nv'>success</span><span class='o'>=</span>ok <span class='nv'>user_unknown</span><span class='o'>=</span>ignore pam_ldap.so
account     required      pam_permit.so

password    requisite     pam_cracklib.so try_first_pass <span class='nv'>retry</span><span class='o'>=</span>3
password    sufficient    pam_unix.so md5 shadow nullok try_first_pass use_authtok
password    sufficient    pam_ldap.so use_authtok
password    required      pam_deny.so

session required pam_mkhomedir.so <span class='nv'>skel</span><span class='o'>=</span>/etc/skel/ <span class='nb'>umask</span><span class='o'>=</span>0022

session     optional      pam_keyinit.so revoke
session     required      pam_limits.so
session     <span class='nv'>success</span><span class='o'>=</span>1 <span class='nv'>default</span><span class='o'>=</span>ignore pam_succeed_if.so service in crond quiet use_uid
session     required      pam_unix.so
session     optional      pam_ldap.so
</code></pre>
</div>
<h3 id='b3_setup_mirror_node'>B.3 SETUP MIRROR NODE</h3>

<h4 id='b31'>B.3.1</h4>

<p>HALMAHERA/192.168.11.215:</p>

<h5 id='b311_slapdconf'>B.3.1.1 slapd.conf</h5>

<p>user@halmahera ~$ sudo cat /usr/local/openldap2.4/etc/openldap/slapd.conf</p>
<div class='highlight'><pre><code class='bash'><span class='c'>#</span>
<span class='c'># See slapd.conf(5) for details on configuration options.</span>
<span class='c'># This file should NOT be world readable.</span>
<span class='c'>#</span>
include         /usr/local/openldap2.4/etc/openldap/schema/core.schema
include         /usr/local/openldap2.4/etc/openldap/schema/corba.schema
include         /usr/local/openldap2.4/etc/openldap/schema/cosine.schema
include         /usr/local/openldap2.4/etc/openldap/schema/nis.schema
include         /usr/local/openldap2.4/etc/openldap/schema/inetorgperson.schema

pidfile         /usr/local/openldap2.4/var/run/slapd.pid
argsfile        /usr/local/openldap2.4/var/run/slapd.args

<span class='c'># Load dynamic backend modules:</span>
 modulepath     /usr/local/openldap2.4

<span class='c'>#######################################################################</span>
<span class='c'># BDB database definitions</span>
<span class='c'>#######################################################################</span>

database        bdb
suffix          <span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span>
rootdn          <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span>
<span class='c'># Cleartext passwords, especially for the rootdn, should</span>
<span class='c'># be avoid.  See slappasswd(8) and slapd.conf(5) for details.</span>
<span class='c'># Use of strong authentication encouraged.</span>
rootpw          domainldap
<span class='c'># The database directory MUST exist prior to running slapd AND</span>
<span class='c'># should only be accessible by the slapd and slap tools.</span>
<span class='c'># Mode 700 recommended.</span>
directory       /usr/local/openldap2.4/var/openldap-data
<span class='c'># Indices to maintain</span>

index objectClass,entryCSN,entryUUID    eq,pres
index ou,cn,mail,surname,givenname      eq,pres,sub
index uidNumber,gidNumber,loginShell    eq,pres
index uid,memberUid                     eq,pres,sub
index nisMapName,nisMapEntry            eq,pres,sub


overlay syncprov
syncprov-checkpoint 100 10
syncprov-sessionlog 100

<span class='c'># Global section</span>
serverID    1
<span class='c'># database section</span>

<span class='c'># syncrepl directive</span>
syncrepl        <span class='nv'>rid</span><span class='o'>=</span>001
                <span class='nv'>provider</span><span class='o'>=</span>ldap://192.168.11.216
                <span class='nv'>bindmethod</span><span class='o'>=</span>simple
                <span class='nv'>binddn</span><span class='o'>=</span><span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span>
                <span class='nv'>credentials</span><span class='o'>=</span>domainldap
                <span class='nv'>searchbase</span><span class='o'>=</span><span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span>
                <span class='nv'>schemachecking</span><span class='o'>=</span>on
                <span class='nb'>type</span><span class='o'>=</span>refreshAndPersist
                <span class='nv'>retry</span><span class='o'>=</span><span class='s2'>&quot;60 +&quot;</span>
mirrormode on
</code></pre>
</div>
<h5 id='b312_etcldapconf'>B.3.1.2 /etc/ldap.conf</h5>

<p>$ vi /etc/ldap.conf</p>
<div class='highlight'><pre><code class='bash'><span class='c'>#Begin</span>
host 127.0.0.1
base <span class='nv'>dc</span><span class='o'>=</span>finnet-indonesia,dc<span class='o'>=</span>com
timelimit 120
bind_timelimit 120
idle_timelimit 3600
nss_initgroups_ignoreusers root,ldap,named,avahi,haldaemon,dbus,radvd,tomcat,radiusd,news,mailman,nscd,gdm,username,rudi
uri ldap://192.168.11.215/
ssl no
tls_cacertdir /etc/openldap/cacerts
pam_password md5
</code></pre>
</div>
<h1 id='eof'>EOF</h1>

<h5 id='b313_auth'>B.3.1.3 Auth</h5>

<h5 id='b314_pam'>B.3.1.4 PAM</h5>

<p>$ vi /etc/pam.d/system-auth</p>
<div class='highlight'><pre><code class='bash'>PAM <span class='o'>(</span>215,216<span class='o'>)</span>:

<span class='c'>#%PAM-1.0</span>
<span class='c'># This file is auto-generated.</span>
<span class='c'># User changes will be destroyed the next time authconfig is run.</span>
auth        required      pam_env.so
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid &gt;<span class='o'>=</span> 500 quiet
auth        sufficient    pam_ldap.so use_first_pass
auth        required      pam_deny.so

session required pam_mkhomedir.so <span class='nv'>skel</span><span class='o'>=</span>/etc/skel/ <span class='nb'>umask</span><span class='o'>=</span>0022

account     required      pam_unix.so broken_shadow
account     sufficient    pam_localuser.so
account     sufficient    pam_succeed_if.so uid &lt; 500 quiet
account     <span class='nv'>default</span><span class='o'>=</span>bad <span class='nv'>success</span><span class='o'>=</span>ok <span class='nv'>user_unknown</span><span class='o'>=</span>ignore pam_ldap.so
account     required      pam_permit.so

password    requisite     pam_cracklib.so try_first_pass <span class='nv'>retry</span><span class='o'>=</span>3
password    sufficient    pam_unix.so md5 shadow nullok try_first_pass use_authtok
password    sufficient    pam_ldap.so use_authtok
password    required      pam_deny.so

session     optional      pam_keyinit.so revoke
session     required      pam_limits.so
session     <span class='nv'>success</span><span class='o'>=</span>1 <span class='nv'>default</span><span class='o'>=</span>ignore pam_succeed_if.so service in crond quiet use_uid
session     required      pam_unix.so
session     optional      pam_ldap.so
</code></pre>
</div>
<h4 id='b32'>B.3.2</h4>

<p>MOROTAI/192.168.11.216:</p>

<h5 id='b321_slapdconf'>B.3.2.1 slapd.conf</h5>

<p>user@morotai ~$ sudo cat /usr/local/openldap2.4/etc/openldap/slapd.conf</p>
<div class='highlight'><pre><code class='bash'><span class='c'>#</span>
<span class='c'># See slapd.conf(5) for details on configuration options.</span>
<span class='c'># This file should NOT be world readable.</span>
<span class='c'>#</span>
include         /usr/local/openldap2.4/etc/openldap/schema/core.schema
include         /usr/local/openldap2.4/etc/openldap/schema/corba.schema
include         /usr/local/openldap2.4/etc/openldap/schema/cosine.schema
include         /usr/local/openldap2.4/etc/openldap/schema/nis.schema
include         /usr/local/openldap2.4/etc/openldap/schema/inetorgperson.schema

pidfile         /usr/local/openldap2.4/var/run/slapd.pid
argsfile        /usr/local/openldap2.4/var/run/slapd.args

<span class='c'># Load dynamic backend modules:</span>
 modulepath     /usr/local/openldap2.4

<span class='c'>#######################################################################</span>
<span class='c'># BDB database definitions</span>
<span class='c'>#######################################################################</span>

database        bdb
suffix          <span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span>
rootdn          <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span>

<span class='c'># Cleartext passwords, especially for the rootdn, should</span>
<span class='c'># be avoid.  See slappasswd(8) and slapd.conf(5) for details.</span>
<span class='c'># Use of strong authentication encouraged.</span>
rootpw          domainldap
<span class='c'># The database directory MUST exist prior to running slapd AND</span>
<span class='c'># should only be accessible by the slapd and slap tools.</span>
<span class='c'># Mode 700 recommended.</span>
directory       /usr/local/openldap2.4/var/openldap-data
<span class='c'># Indices to maintain</span>

index objectClass,entryCSN,entryUUID    eq,pres
index ou,cn,mail,surname,givenname      eq,pres,sub
index uidNumber,gidNumber,loginShell    eq,pres
index uid,memberUid                     eq,pres,sub
index nisMapName,nisMapEntry            eq,pres,sub


overlay syncprov
syncprov-checkpoint 100 10
syncprov-sessionlog 100

<span class='c'># Global section</span>
serverID    2
<span class='c'># database section</span>

<span class='c'># syncrepl directive</span>
syncrepl        <span class='nv'>rid</span><span class='o'>=</span>001
                <span class='nv'>provider</span><span class='o'>=</span>ldap://192.168.11.215
                <span class='nv'>bindmethod</span><span class='o'>=</span>simple
                <span class='nv'>binddn</span><span class='o'>=</span><span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span>
                <span class='nv'>credentials</span><span class='o'>=</span>domainldap
                <span class='nv'>searchbase</span><span class='o'>=</span><span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span>
                <span class='nv'>schemachecking</span><span class='o'>=</span>on
                <span class='nb'>type</span><span class='o'>=</span>refreshAndPersist
                <span class='nv'>retry</span><span class='o'>=</span><span class='s2'>&quot;60 +&quot;</span>
mirrormode on

user@morotai ~<span class='err'>$</span>
</code></pre>
</div>
<p>B.3.2.2 ldap.conf</p>

<p>$ vi /etc/ldap.conf:</p>
<div class='highlight'><pre><code class='bash'><span class='c'>#Begin</span>
host 127.0.0.1
base <span class='nv'>dc</span><span class='o'>=</span>finnet-indonesia,dc<span class='o'>=</span>com
timelimit 120
bind_timelimit 120
idle_timelimit 3600
nss_initgroups_ignoreusers root,ldap,named,avahi,haldaemon,dbus,radvd,tomcat,radiusd,news,mailman,nscd,gdm,username,rudi
uri ldap://192.168.11.216/
ssl no
tls_cacertdir /etc/openldap/cacerts
pam_password md5
</code></pre>
</div>
<h1 id='eof'>EOF</h1>

<h5 id='b323_auth'>B.3.2.3 Auth</h5>

<h5 id='b324_pam'>B.3.2.4 PAM</h5>

<p>$ vi /etc/pam.d/system-auth</p>

<p>PAM:</p>
<div class='highlight'><pre><code class='bash'><span class='c'>#%PAM-1.0</span>
<span class='c'># This file is auto-generated.</span>
<span class='c'># User changes will be destroyed the next time authconfig is run.</span>
auth        required      pam_env.so
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid &gt;<span class='o'>=</span> 500 quiet
auth        sufficient    pam_ldap.so use_first_pass
auth        required      pam_deny.so

account     required      pam_unix.so broken_shadow
account     sufficient    pam_succeed_if.so uid &lt; 500 quiet
account     sufficient    pam_localuser.so
account     <span class='nv'>default</span><span class='o'>=</span>bad <span class='nv'>success</span><span class='o'>=</span>ok <span class='nv'>user_unknown</span><span class='o'>=</span>ignore pam_ldap.so
account     required      pam_permit.so

session required pam_mkhomedir.so <span class='nv'>skel</span><span class='o'>=</span>/etc/skel/ <span class='nb'>umask</span><span class='o'>=</span>0022

password    requisite     pam_cracklib.so try_first_pass <span class='nv'>retry</span><span class='o'>=</span>3
password    sufficient    pam_unix.so md5 shadow nullok try_first_pass use_authtok
password    sufficient    pam_ldap.so use_authtok
password    required      pam_deny.so

session     required      pam_mkhomedir.so <span class='nv'>skel</span><span class='o'>=</span>/etc/skel/ <span class='nb'>umask</span><span class='o'>=</span>0066

session     optional      pam_keyinit.so revoke
session     required      pam_limits.so
session     <span class='nv'>success</span><span class='o'>=</span>1 <span class='nv'>default</span><span class='o'>=</span>ignore pam_succeed_if.so service in crond quiet use_uid
session     required      pam_unix.so
session     optional      pam_ldap.so
</code></pre>
</div>
<h2 id='c_testing'>C. Testing</h2>

<h3 id='c1_test_openssl'>C.1 Test Openssl</h3>
<div class='highlight'><pre><code class='bash'>root@morotai ssl# openssl s_client -connect localhost:636 -showcerts
CONNECTED<span class='o'>(</span>00000003<span class='o'>)</span>
<span class='nv'>depth</span><span class='o'>=</span>0 /C<span class='o'>=</span>ID/ST<span class='o'>=</span>Jakarta/L<span class='o'>=</span>Jakarta/O<span class='o'>=</span>Finnet/OU<span class='o'>=</span>Finnet/CN<span class='o'>=</span>morotai.finnet-indonesia.com/emailAddress<span class='o'>=</span>username@noc.finnet-indonesia.com
verify error:num<span class='o'>=</span>18:self signed certificate
verify <span class='k'>return</span>:1
<span class='nv'>depth</span><span class='o'>=</span>0 /C<span class='o'>=</span>ID/ST<span class='o'>=</span>Jakarta/L<span class='o'>=</span>Jakarta/O<span class='o'>=</span>Finnet/OU<span class='o'>=</span>Finnet/CN<span class='o'>=</span>morotai.finnet-indonesia.com/emailAddress<span class='o'>=</span>username@noc.finnet-indonesia.com
verify <span class='k'>return</span>:1
---
Certificate chain
 0 s:/C<span class='o'>=</span>ID/ST<span class='o'>=</span>Jakarta/L<span class='o'>=</span>Jakarta/O<span class='o'>=</span>Finnet/OU<span class='o'>=</span>Finnet/CN<span class='o'>=</span>morotai.finnet-indonesia.com/emailAddress<span class='o'>=</span>username@noc.finnet-indonesia.com
   i:/C<span class='o'>=</span>ID/ST<span class='o'>=</span>Jakarta/L<span class='o'>=</span>Jakarta/O<span class='o'>=</span>Finnet/OU<span class='o'>=</span>Finnet/CN<span class='o'>=</span>morotai.finnet-indonesia.com/emailAddress<span class='o'>=</span>username@noc.finnet-indonesia.com
-----BEGIN CERTIFICATE-----
MIID4zCCA0ygAwIBAgIJAPqgYszfNWU6MA0GCSqGSIb3DQEBBQUAMIGoMQswCQYD
VQQGEwJJRDEQMA4GA1UECBMHSmFrYXJ0YTEQMA4GA1UEBxMHSmFrYXJ0YTEPMA0G
A1UEChMGRmlubmV0MQ8wDQYDVQQLEwZGaW5uZXQxJTAjBgNVBAMTHG1vcm90YWku
ZmlubmV0LWluZG9uZXNpYS5jb20xLDAqBgkqhkiG9w0BCQEWHWRpYW5Abm9jLmZp
bm5ldC1pbmRvbmVzaWEuY29tMB4XDTEwMDkwODExMDA0MloXDTIwMDkwNTExMDA0
MlowgagxCzAJBgNVBAYTAklEMRAwDgYDVQQIEwdKYWthcnRhMRAwDgYDVQQHEwdK
YWthcnRhMQ8wDQYDVQQKEwZGaW5uZXQxDzANBgNVBAsTBkZpbm5ldDElMCMGA1UE
AxMcbW9yb3RhaS5maW5uZXQtaW5kb25lc2lhLmNvbTEsMCoGCSqGSIb3DQEJARYd
ZGlhbkBub2MuZmlubmV0LWluZG9uZXNpYS5jb20wgZ8wDQYJKoZIhvcNAQEBBQAD
gY0AMIGJAoGBAK1DMnEL0a7yGcjgvgok1X4sA3auRLYhkVS4/KlyLVTq6hmzQ3St
a+FbpxVZ74nqI7puORT8V/YTNwgxgWyASzmwW1EgnFlDFCFasRrhSbvEoPaWERPY
O2d7kw9PzodJxxxT5auRKjZiLWGoIiQaxlXKWclFvQFQlpmRWUhBk7uDAgMBAAGj
ggERMIIBDTAdBgNVHQ4EFgQUPoQzE33QnV+O/iqUk5ovxmmJjn8wgd0GA1UdIwSB
1TCB0oAUPoQzE33QnV+O/iqUk5ovxmmJjn+hga6kgaswgagxCzAJBgNVBAYTAklE
MRAwDgYDVQQIEwdKYWthcnRhMRAwDgYDVQQHEwdKYWthcnRhMQ8wDQYDVQQKEwZG
aW5uZXQxDzANBgNVBAsTBkZpbm5ldDElMCMGA1UEAxMcbW9yb3RhaS5maW5uZXQt
aW5kb25lc2lhLmNvbTEsMCoGCSqGSIb3DQEJARYdZGlhbkBub2MuZmlubmV0LWlu
ZG9uZXNpYS5jb22CCQD6oGLM3zVlOjAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEB
BQUAA4GBAGKGyIswW15KesUIszaZ9fHxi749HSSO0R+izduKjWYZnERfWvm+M8QT
L00Db1sL17iarX57sQwLQSqtRsZVSALgZ6rhIvtwHlMsfPULI2rofd50U9BquHVp
YRehmyS45vYR+D2i+fpb5cL3zYEg+foV/TG3qwwIJBCKm8ugzvgh
-----END CERTIFICATE-----
---
Server certificate
<span class='nv'>subject</span><span class='o'>=</span>/C<span class='o'>=</span>ID/ST<span class='o'>=</span>Jakarta/L<span class='o'>=</span>Jakarta/O<span class='o'>=</span>Finnet/OU<span class='o'>=</span>Finnet/CN<span class='o'>=</span>morotai.finnet-indonesia.com/emailAddress<span class='o'>=</span>username@noc.finnet-indonesia.com
<span class='nv'>issuer</span><span class='o'>=</span>/C<span class='o'>=</span>ID/ST<span class='o'>=</span>Jakarta/L<span class='o'>=</span>Jakarta/O<span class='o'>=</span>Finnet/OU<span class='o'>=</span>Finnet/CN<span class='o'>=</span>morotai.finnet-indonesia.com/emailAddress<span class='o'>=</span>username@noc.finnet-indonesia.com
---
No client certificate CA names sent
---
SSL handshake has <span class='nb'>read </span>1168 bytes and written 319 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 1024 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
    Session-ID: EA07728E6693DDC8C536811BEEFEBA426E920453868BF0C9409BDA85CDCE2D0B
    Session-ID-ctx:
    Master-Key: 7425A4061CD8951C33BA508DA73E50BDEA31C7144231347F478ACCBA361177C495C028E3F4F7BD55E93108D10CA7DD09
    Key-Arg   : None
    Krb5 Principal: None
    Start Time: 1290683048
    Timeout   : 300 <span class='o'>(</span>sec<span class='o'>)</span>
    Verify <span class='k'>return </span>code: 18 <span class='o'>(</span>self signed certificate<span class='o'>)</span>
---
</code></pre>
</div>
<h3 id='c2_test_openldap'>C.2 Test Openldap</h3>

<p>ldif data:</p>
<div class='highlight'><pre><code class='bash'><span class='nv'>$ </span>cat /home/username/tes2.ldif
dn: <span class='nv'>ou</span><span class='o'>=</span>Timur,dc<span class='o'>=</span>finnet-indonesia,dc<span class='o'>=</span>com
objectClass: organizationalUnit
ou: Timur
description: Divre Bagian Timur
</code></pre>
</div>
<h4 id='c21_nonssl'>C.2.1 Non-ssl</h4>

<p>debug:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap2.4/libexec/slapd -h ldap:/// -u ldap -f /usr/local/openldap2.4/etc/openldap/slapd.conf -d -1
</code></pre>
</div>
<p>search:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap2.4/bin/ldapsearch -x
</code></pre>
</div>
<p>add:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap2.4/bin/ldapadd -x -D <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span> -f /home/user/tes2.ldif -W
</code></pre>
</div>
<p>delete:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap2.4/bin/ldapdelete -D <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span> -w domainldap <span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span> <span class='s2'>&quot;ou=Barat,dc=domain-indonesia,dc=com&quot;</span>
</code></pre>
</div>
<h4 id='c22_withssl'>C.2.2 With-ssl</h4>

<p>debug:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap/libexec/slapd -h <span class='s2'>&quot;ldaps:/// ldap:///&quot;</span> -u ldap -f /usr/local/openldap2.4/etc/openldap/slapd.conf -d -1
</code></pre>
</div>
<p>search:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap/bin/ldapsearch -x
</code></pre>
</div>
<p>add:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap/bin/ldapadd -x -D <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span> -f /home/user/tes2.ldif -W
</code></pre>
</div>
<p>delete:</p>
<div class='highlight'><pre><code class='bash'>sudo /usr/local/openldap/bin/ldapdelete -D <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span> -w domainldap <span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span> <span class='s2'>&quot;ou=Barat,dc=domain-indonesia,dc=com&quot;</span>
</code></pre>
</div>
<h3 id='open_ldap_script'>Open LDAP Script</h3>

<p>Grab this openldap.sh script and put into <code>/etc/init.d/</code>.</p>
<script src='https://gist.github.com/1116366.js?file=openldap.sh' type='text/javascript'>
</script>
<h3 id='c3_start_stop_and_restart_service_ldap'>C.3 Start, stop and restart Service ldap</h3>

<p>start:</p>
<div class='highlight'><pre><code class='bash'><span class='c'># /etc/init.d/ldap start</span>
</code></pre>
</div>
<p>stop:</p>
<div class='highlight'><pre><code class='bash'><span class='c'># /etc/init.d/ldap stop</span>
</code></pre>
</div>
<p>restart:</p>
<div class='highlight'><pre><code class='bash'><span class='c'># /etc/init.d/ldap restart</span>
</code></pre>
</div>
<h2 id='referensi'>referensi:</h2>

<ol>
<li><a href='http://s0t4.blogspot.com/2010/05/instalasi-source-openldap-2421-di.html'>http://s0t4.blogspot.com/2010/05/instalasi-source-openldap-2421-di.html</a></li>

<li><a href='http://download.oracle.com/docs/cd/E17076_01/html/installation/build_unix.html'>http://download.oracle.com/docs/cd/E17076_01/html/installation/build_unix.html</a></li>

<li><a href='http://lists.arthurdejong.org/openldap-technical/2008/09/msg00011.html'>http://lists.arthurdejong.org/openldap-technical/2008/09/msg00011.html</a></li>

<li><a href='http://www.openldap.org/doc/admin24/replication.html'>http://www.openldap.org/doc/admin24/replication.html</a></li>

<li><a href='http://itsecureadmin.com/wiki/index.php/OpenLDAP_Multi-Master_Replication'>http://itsecureadmin.com/wiki/index.php/OpenLDAP_Multi-Master_Replication</a></li>

<li><a href='http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch31_:_Centralized_Logins_Using_LDAP_and_RADIUS'>http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch31_:_Centralized_Logins_Using_LDAP_and_RADIUS</a></li>
</ol>
</div>



<div id="disqus_thread"></div>

<script type="text/javascript" src="http://disqus.com/forums/buildsystem/embed.js">
</script>

<noscript>
    <p> <a href="http://nebansnotebook.disqus.com/?url=ref">View the discussion thread. </a> </p>
</noscript>



<div class="prevnext">
    
        <div class="prev">
            &laquo; <a href="/2010/12/20/Install-KVM-Virtualization-on-Debian-Squeeze.html"> Install KVM Virtualization on Debian Squeeze </a>
        </div>
    

    
        <div class="next">
            <a href="/2011/03/04/create-own-repo-rhel-6.0-beta-from-iso.html"> create own repo RHEL 6.0 beta from ISO </a> &raquo;
        </div>
    
</div>




            </div>
            
<div class="footer">
   <center>
	<small>alinux.web.id, established since 2007, hosted by <a target="_new" href="http://tor.hu">tor.hu</a>, powered by <a target="_new" href="http://www.vim.org">vim</a> and <a target="_new" href="http://jekyllrb.com">jekyll</a><br/>
<a target="_new" href="https://github.com/deanet/alinux-documentation">source</a>
</small>
	</center>
</div>

            <div class="pageend"></div>
        </div>
    </div>
</body>
</html>

