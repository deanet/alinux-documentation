<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>How to kill windows process and integrated with nagios using Nsclient++ on Gnu/Linux &laquo; alinux.web.id</title>
	<meta name="author" content="deanet">
	<link href="atom.xml" rel="alternate" title="build system from God's systems" type="application/atom+xml" />
	<link rel="stylesheet" href="/css/site.css" type="text/css" media="screen, projection" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<meta name="viewport" content="width=850" />
	<link rel="stylesheet" media="screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" />

<script type="text/javascript" src="http://use.typekit.com/aoe6dic.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12495571-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<script type="text/javascript">
        var disqus_awesome = true; 
        var disqus_developer = true;
</script>    
</head>

<body>
<div id="container">
	<div id="header">
		<div id="logo">
	<a class="site" href="/index.html">home</a>
</div>
<div id="navbar">
	<a class="site" href="/atom.xml">rss</a>
</div>

	</div>
	<div id="page">
		<div id="content">
		<div id="post" class="post">
	<span class="title">How to kill windows process and integrated with nagios using Nsclient++ on Gnu/Linux</span><br />
	<span class="date">Jul 29 2010</span><br />
	<span class="content"><p><code>Nagios</code> : a powerful monitoring system that enables organizations to identify and resolve IT infrastructure problems before they affect critical business processes.</p>

<p><code>NRPE addon for Nagios</code> : an addon that allows you to execute plugins on remote Linux/Unix hosts. This is useful if you need to monitor local resources/attributes like disk usage, CPU load, memory usage, etc. on a remote host.</p>

<p><code>Nsclient++</code> : NSClient++ (or nscp as I tend to call it nowadays) aims to be a simple yet powerful and secure monitoring daemon for Windows operating systems. on Nsclient++ we can run nrpe handler too.</p>

<h1 id='how_windows_process_work_'>How windows process work ?</h1>

<p>Each process provides the resources needed to execute a program. A process has a virtual address space, executable code, open handles to system objects, a security context, a unique process identifier, environment variables, a priority class, minimum and maximum working set sizes, and at least one thread of execution. Each process is started with a single thread, often called the primary thread, but can create additional threads from any of its threads.</p>

<p>A thread is the entity within a process that can be scheduled for execution. All threads of a process share its virtual address space and system resources. In addition, each thread maintains exception handlers, a scheduling priority, thread local storage, a unique thread identifier, and a set of structures the system will use to save the thread context until it is scheduled. The thread context includes the thread&#8217;s set of machine registers, the kernel stack, a thread environment block, and a user stack in the address space of the thread&#8217;s process. Threads can also have their own security context, which can be used for impersonating clients.</p>

<h1 id='how_to_kill_windows_process_using_own_windows_application_'>How to kill windows process using own windows application ?</h1>

<p>Processes can be ended by process ID or image name. Taskkill replaces the kill tool same as on Gnu/Linux environment.</p>

<h1 id='and_last_how_nrpe_can_kill_windows_process_via_nagios_on_gnulinux_host_monitoring_'>And last, How NRPE can kill windows process via Nagios on Gnu/Linux host monitoring ?</h1>

<p>First, NRPE Plugin will check daemon of NRPE/Nsclient++ on windows machine. And then, if command argument handler allow to execute on local script windows/taskkill command, it will be executed. on this case, local script windows using wmi script. And Second, make interface using php shell exec to run kill command via web base nagios that integrated it.</p>

<h1 id='prepare'>Prepare.</h1>

<ol>
<li>Install Nagios on your host monitoring.</li>

<li>Download and install NRPE plugin. <a href='http://www.monitoringexchange.org/inventory/Utilities/AddOn-Projects/Communication/NRPE/NRPE'>monitoringexchange.org</a></li>

<li>Download and install Nsclient++ on your remote monitoring. <a href='http://sourceforge.net/projects/nscplus/files/nscplus/'>download here</a> you can see my Nsclient++ conf on <a href='/files/nsc.conf' target='_new'>here</a> to walk out of this experiment. or u just added <code>nrpe handler</code> below:</li>
</ol>
<div class='highlight'><pre><span class='o'>[</span><span class='no'>NRPE</span> <span class='no'>Handlers</span><span class='o'>]</span>
<span class='n'>command</span><span class='o'>[</span><span class='n'>show_os</span><span class='o'>]=</span><span class='n'>cscript</span><span class='o'>.</span><span class='n'>exe</span><span class='sr'> //nologo /</span><span class='o'>/</span><span class='n'>T</span><span class='p'>:</span><span class='mi'>60</span> <span class='n'>C</span><span class='p'>:\</span><span class='n'>wmi</span><span class='o'>-</span><span class='mi'>1</span><span class='o'>.</span><span class='mi'>3</span><span class='p'>\</span><span class='n'>verify_wmi_status</span><span class='o'>.</span><span class='n'>vbs</span> <span class='o'>-</span><span class='n'>h</span> <span class='s2'>&quot;$ARG1$&quot;</span>
<span class='n'>command</span><span class='o'>[</span><span class='n'>kill_procs</span><span class='o'>]=</span><span class='n'>C</span><span class='p'>:\</span><span class='no'>WINDOWS</span><span class='p'>\</span><span class='n'>system32</span><span class='p'>\</span><span class='n'>taskkill</span><span class='o'>.</span><span class='n'>exe</span><span class='sr'> /S 127.0.0.1 /</span><span class='no'>IM</span> <span class='s2'>&quot;$ARG1$&quot;</span><span class='sr'> /F</span>
<span class='sr'>command[show_procs]=cscript.exe /</span><span class='o'>/</span><span class='n'>nologo</span><span class='sr'> //T:60 C:\wmi-1.3\get_computer_info.vbs -h &quot;$ARG1$&quot; -i running_processes</span>
</pre>
</div>
<ol>
<li>Download and put this wmi agents plugin to C:. <a href='http://monitoringforge.org/plugins/esp_frs/file.php?fileid=1974&id=1658&group_id=482&relid=1398&browse_file=y' target='_new'>download here</a></li>
</ol>

<h1 id='poc'>PoC</h1>

<p>Let me see</p>
<div class='highlight'><pre><span class='n'>C</span><span class='p'>:\</span><span class='no'>Documents</span> <span class='ow'>and</span> <span class='no'>Settings</span><span class='p'>\</span><span class='n'>alinux</span><span class='o'>&gt;</span><span class='n'>tasklist</span>

<span class='no'>Image</span> <span class='no'>Name</span>                   <span class='no'>PID</span> <span class='no'>Session</span> <span class='no'>Name</span>     <span class='no'>Session</span><span class='c1'>#    Mem Usage</span>
<span class='o'>=========================</span> <span class='o'>======</span> <span class='o'>================</span> <span class='o'>========</span> <span class='o'>============</span>
<span class='no'>System</span>                         <span class='mi'>4</span> <span class='no'>Console</span>                 <span class='mi'>0</span>         <span class='mi'>36</span> <span class='n'>K</span>
<span class='no'>SMSS</span><span class='o'>.</span><span class='n'>EXE</span>                     <span class='mi'>424</span> <span class='no'>Console</span>                 <span class='mi'>0</span>         <span class='mi'>32</span> <span class='n'>K</span>
<span class='no'>CSRSS</span><span class='o'>.</span><span class='n'>EXE</span>                    <span class='mi'>572</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>2</span><span class='p'>,</span><span class='mi'>164</span> <span class='n'>K</span>
<span class='no'>WINLOGON</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>596</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>796</span> <span class='n'>K</span>
<span class='no'>SERVICES</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>748</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>336</span> <span class='n'>K</span>
<span class='no'>LSASS</span><span class='o'>.</span><span class='n'>EXE</span>                    <span class='mi'>760</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>736</span> <span class='n'>K</span>
<span class='no'>VBoxService</span><span class='o'>.</span><span class='n'>exe</span>              <span class='mi'>916</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>808</span> <span class='n'>K</span>
<span class='no'>SVCHOST</span><span class='o'>.</span><span class='n'>EXE</span>                  <span class='mi'>928</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>616</span> <span class='n'>K</span>
<span class='no'>SVCHOST</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>1012</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>364</span> <span class='n'>K</span>
<span class='no'>SVCHOST</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>1132</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>8</span><span class='p'>,</span><span class='mo'>00</span><span class='mi'>8</span> <span class='n'>K</span>
<span class='no'>SVCHOST</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>1228</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>920</span> <span class='n'>K</span>
<span class='no'>SVCHOST</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>1380</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>588</span> <span class='n'>K</span>
<span class='no'>SPOOLSV</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>1512</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>4</span><span class='p'>,</span><span class='mi'>972</span> <span class='n'>K</span>
<span class='no'>ALG</span><span class='o'>.</span><span class='n'>EXE</span>                      <span class='mi'>432</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>228</span> <span class='n'>K</span>
<span class='no'>EXPLORER</span><span class='o'>.</span><span class='n'>EXE</span>                <span class='mi'>1852</span> <span class='no'>Console</span>                 <span class='mi'>0</span>     <span class='mi'>16</span><span class='p'>,</span><span class='mo'>072</span> <span class='n'>K</span>
<span class='no'>VBoxTray</span><span class='o'>.</span><span class='n'>exe</span>                <span class='mi'>1928</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>332</span> <span class='n'>K</span>
<span class='no'>GrooveMonitor</span><span class='o'>.</span><span class='n'>exe</span>           <span class='mi'>1936</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>760</span> <span class='n'>K</span>
<span class='no'>CTFMON</span><span class='o'>.</span><span class='n'>EXE</span>                  <span class='mi'>1948</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>652</span> <span class='n'>K</span>
<span class='n'>cmd</span><span class='o'>.</span><span class='n'>exe</span>                     <span class='mi'>1056</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>796</span> <span class='n'>K</span>
<span class='n'>openvpn</span><span class='o'>-</span><span class='n'>gui</span><span class='o'>-</span><span class='mi'>1</span><span class='o'>.</span><span class='mi'>0</span><span class='o'>.</span><span class='mi'>3</span><span class='o'>.</span><span class='n'>exe</span>       <span class='mi'>1124</span> <span class='no'>Console</span>                 <span class='mi'>0</span>        <span class='mi'>240</span> <span class='n'>K</span>
<span class='n'>firefox</span><span class='o'>.</span><span class='n'>exe</span>                 <span class='mi'>1784</span> <span class='no'>Console</span>                 <span class='mi'>0</span>     <span class='mi'>17</span><span class='p'>,</span><span class='mi'>652</span> <span class='n'>K</span>
<span class='no'>SVCHOST</span><span class='o'>.</span><span class='n'>EXE</span>                 <span class='mi'>1080</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>1</span><span class='p'>,</span><span class='mi'>948</span> <span class='n'>K</span>
<span class='n'>tasklist</span><span class='o'>.</span><span class='n'>exe</span>                <span class='mi'>1616</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>4</span><span class='p'>,</span><span class='mi'>340</span> <span class='n'>K</span>
<span class='n'>wmiprvse</span><span class='o'>.</span><span class='n'>exe</span>                 <span class='mi'>688</span> <span class='no'>Console</span>                 <span class='mi'>0</span>      <span class='mi'>5</span><span class='p'>,</span><span class='mi'>528</span> <span class='n'>K</span>
</pre>
</div><div class='highlight'><pre><span class='n'>C</span><span class='p'>:\</span><span class='no'>Documents</span> <span class='ow'>and</span> <span class='no'>Settings</span><span class='p'>\</span><span class='n'>alinux</span><span class='o'>&gt;</span><span class='n'>taskkill</span><span class='sr'> /IM firefox.exe</span>
<span class='sr'>SUCCESS: The process &quot;firefox.exe&quot; with PID 1784 has been terminated.</span>

<span class='sr'>C:\Documents and Settings\alinux&gt;</span>
</pre>
</div>
<p>Now, assumsed your Nagios and Nsclient++ works properly.</p>

<h3 id='nagios'>Nagios</h3>
<div class='highlight'><pre>alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='nv'>$ </span>sudo /etc/init.d/nagios status
checking /usr/sbin/nagios...done <span class='o'>(</span>running<span class='o'>)</span>.
alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='err'>$</span>
</pre>
</div>
<h3 id='nsclient'>Nsclient++</h3>
<div class='highlight'><pre>C:<span class='se'>\P</span>rogram Files<span class='se'>\N</span>SClient++&gt;netstat -a

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    de-89f18a389752:epmap  de-89f18a389752:0      LISTENING
  TCP    de-89f18a389752:microsoft-ds  de-89f18a389752:0      LISTENING
  TCP    de-89f18a389752:3389   de-89f18a389752:0      LISTENING
  TCP    de-89f18a389752:5666   de-89f18a389752:0      LISTENING
  TCP    de-89f18a389752:12489  de-89f18a389752:0      LISTENING
  TCP    de-89f18a389752:1026   de-89f18a389752:0      LISTENING
  TCP    de-89f18a389752:netbios-ssn  de-89f18a389752:0      LISTENING
</pre>
</div>
<p>Nsclient using port 12489 and NRPE using port 5666.</p>

<h2 id='check_nrpe_handler_command_on_windows_machine'>Check NRPE handler command on windows machine</h2>
<div class='highlight'><pre>C:<span class='se'>\P</span>rogram Files<span class='se'>\N</span>SClient++&gt;cscript.exe //nologo //T:60 C:<span class='se'>\w</span>mi-1.3<span class='se'>\v</span>erify_wmi_status.vbs -h 192.168.0.3
OK - Microsoft Windows XP Professional, SP 2.0

C:<span class='se'>\P</span>rogram Files<span class='se'>\N</span>SClient++&gt;
</pre>
</div>
<h2 id='check_nrpe_handler_command_on_host_monitoring'>Check NRPE handler command on host monitoring</h2>
<div class='highlight'><pre>alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='nv'>$ </span>./check_nrpe -H 192.168.0.3 -c show_os -a 192.168.0.3
OK - Microsoft Windows XP Professional, SP 2.0
alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='err'>$</span>
</pre>
</div>
<p>Ok, sounds like good. Now, test kill process of nrpe handler command:</p>

<h2 id='on_host_monitoring'>on host monitoring</h2>

<p>on example, i was killing notepad.exe process.</p>
<div class='highlight'><pre>alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='nv'>$ </span>./check_nrpe -H 192.168.0.3 -c kill_procs -a notepad.exe
SUCCESS: The process <span class='s2'>&quot;NOTEPAD.EXE&quot;</span> with PID 1464 has been terminated.
SUCCESS: The process <span class='s2'>&quot;NOTEPAD.EXE&quot;</span> with PID 708 has been terminated.
SUCCESS: The process <span class='s2'>&quot;NOTEPAD.EXE&quot;</span> with PID 1972 has been terminated.
alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='err'>$</span>
</pre>
</div>
<p>all process by name notepad.exe would be killed. you can terminate/kill process by pid.</p>

<h1 id='integrating_with_nagios'>Integrating with nagios.</h1>

<p>by doing check command line use <code>check_nrpe</code> :</p>
<div class='highlight'><pre>alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='nv'>$ </span>./check_nrpe -H 192.168.0.3 -c show_procs -a 192.168.0.3
Host name: 192.168.0.3; Running Processes: System Idle Process, System, SMSS.EXE, CSRSS.EXE, WINLOGON.EXE, SERVICES.EXE, LSASS.EXE,
VBoxService.exe, SVCHOST.EXE, SVCHOST.EXE, SVCHOST.EXE, SVCHOST.EXE, SVCHOST.EXE, SPOOLSV.EXE, ALG.EXE, EXPLORER.EXE, VBoxTray.exe,
GrooveMonitor.exe, CTFMON.EXE, cmd.exe, openvpn-gui-1.0.3.exe, SVCHOST.EXE, NOTEPAD.EXE, nsclient++.exe, cscript.exe, wmiprvse.exe,
alinux@denbaguse:/usr/src/nrpe-2.0/src<span class='err'>$</span>
</pre>
</div>
<p>k, lets begin to php code</p>
<div class='highlight'><pre><span class='cp'>&lt;?php</span>

<span class='c1'>//catch</span>
<span class='nv'>$host</span> <span class='o'>=</span> <span class='nv'>$_GET</span><span class='p'>[</span><span class='s2'>&quot;ip&quot;</span><span class='p'>];</span>
<span class='nv'>$IM</span> <span class='o'>=</span> <span class='nv'>$_GET</span><span class='p'>[</span><span class='s2'>&quot;im&quot;</span><span class='p'>];</span>
<span class='nv'>$config</span> <span class='o'>=</span> <span class='nv'>$_GET</span><span class='p'>[</span><span class='s2'>&quot;conf&quot;</span><span class='p'>];</span>

<span class='c1'>//filter process name</span>
<span class='k'>if</span><span class='p'>(</span><span class='nv'>$IM</span> <span class='o'>==</span> <span class='s2'>&quot;&quot;</span><span class='p'>){</span>
<span class='nv'>$killer</span> <span class='o'>=</span> <span class='s2'>&quot;&quot;</span><span class='p'>;</span>
<span class='p'>}</span>
<span class='k'>else</span> <span class='k'>if</span><span class='p'>(</span><span class='nv'>$IM</span> <span class='o'>!==</span> <span class='s2'>&quot;&quot;</span> <span class='o'>&amp;&amp;</span> <span class='nv'>$host</span> <span class='o'>==</span> <span class='s2'>&quot;172.16.0.35&quot;</span><span class='p'>)</span> <span class='p'>{</span>
<span class='k'>echo</span> <span class='s2'>&quot;&lt;script&gt;alert(&#39;sorry u cant kill anything process on this host :P&#39;)&lt;/script&gt;&quot;</span><span class='p'>;</span>
<span class='p'>}</span>
<span class='k'>else</span> <span class='p'>{</span>
<span class='nv'>$killer</span> <span class='o'>=</span> <span class='s1'>&#39;/usr/src/nrpe-2.0/src/check_nrpe -H &#39;</span><span class='o'>.</span><span class='nv'>$host</span><span class='o'>.</span><span class='s1'>&#39; -c kill_procs -a &#39;</span><span class='o'>.</span>
<span class='nv'>$IM</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='c1'>//executor kill process</span>
<span class='nv'>$output</span> <span class='o'>=</span> <span class='nb'>shell_exec</span><span class='p'>(</span><span class='nv'>$killer</span><span class='p'>);</span>


<span class='c1'>//filter host</span>
<span class='k'>if</span><span class='p'>(</span><span class='nv'>$host</span> <span class='o'>==</span> <span class='s2'>&quot;&quot;</span><span class='p'>){</span>
<span class='nv'>$show_proses</span> <span class='o'>=</span> <span class='s2'>&quot;&quot;</span><span class='p'>;</span>
<span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
<span class='nv'>$show_proses</span> <span class='o'>=</span> <span class='s1'>&#39;/usr/src/nrpe-2.0/src/check_nrpe -H &#39;</span><span class='o'>.</span><span class='nv'>$host</span><span class='o'>.</span><span class='s1'>&#39; -c show_procs -a 127.0.0.1&#39;</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='c1'>//executor show process</span>
<span class='nv'>$show_procs</span> <span class='o'>=</span> <span class='nb'>shell_exec</span><span class='p'>(</span><span class='nv'>$show_proses</span><span class='p'>);</span>


<span class='c1'>//filter config</span>

<span class='k'>if</span><span class='p'>(</span><span class='nv'>$config</span> <span class='o'>==</span> <span class='s2'>&quot;1&quot;</span><span class='p'>){</span>
<span class='nv'>$run_config</span> <span class='o'>=</span> <span class='s1'>&#39;/usr/src/nrpe-2.0/src/check_nrpe -H &#39;</span><span class='o'>.</span><span class='nv'>$host</span><span class='o'>.</span><span class='s1'>&#39; -c update_config&#39;</span><span class='p'>;</span>
<span class='p'>}</span>
<span class='k'>else</span> <span class='k'>if</span> <span class='p'>(</span><span class='nv'>$config</span> <span class='o'>==</span> <span class='s2'>&quot;&quot;</span><span class='p'>){</span>
<span class='nv'>$run_config</span> <span class='o'>=</span> <span class='s2'>&quot;&quot;</span><span class='p'>;</span>
<span class='p'>}</span>
<span class='k'>else</span> <span class='p'>{</span>

<span class='k'>echo</span> <span class='s2'>&quot;&lt;script&gt;alert(&#39;config value isnt valid&#39;)&lt;/script&gt;&quot;</span><span class='p'>;</span>

<span class='p'>}</span>

<span class='c1'>//executor update config</span>
<span class='nv'>$update_config</span> <span class='o'>=</span> <span class='nb'>shell_exec</span><span class='p'>(</span><span class='nv'>$run_config</span><span class='p'>);</span>
<span class='cp'>?&gt;</span><span class='x' />
<span class='x'>&lt;!--</span>
<span class='x'>simply process killer using nrpe</span>
<span class='x'>pure coding php :lol:</span>
<span class='x'>--&gt;</span>

<span class='cp'>&lt;?php</span>
<span class='k'>echo</span> <span class='s2'>&quot;&lt;b&gt;Process on </span><span class='si'>$host</span><span class='s2'>&lt;/b&gt;:&lt;br&gt; &quot;</span><span class='p'>;</span>
<span class='k'>echo</span> <span class='s2'>&quot;&lt;pre&gt;</span><span class='si'>$output</span><span class='s2'>&lt;/pre&gt;&lt;br/&gt;&quot;</span><span class='p'>;</span>
<span class='c1'>//echo &quot;$show_procs&lt;br/&gt;&quot;;</span>

<span class='nv'>$explode</span> <span class='o'>=</span> <span class='nb'>explode</span><span class='p'>(</span><span class='s2'>&quot;, &quot;</span><span class='p'>,</span><span class='nv'>$show_procs</span><span class='p'>);</span>
<span class='k'>for</span><span class='p'>(</span><span class='nv'>$i</span><span class='o'>=</span><span class='m'>0</span><span class='p'>;</span> <span class='nv'>$i</span><span class='o'>&lt;</span><span class='p'>(</span><span class='nb'>count</span><span class='p'>(</span><span class='nv'>$explode</span><span class='p'>));</span><span class='nv'>$i</span><span class='o'>++</span><span class='p'>){</span>
<span class='k'>echo</span> <span class='s2'>&quot;&lt;a href=</span><span class='se'>\&quot;</span><span class='s2'>index.php?ip=&quot;</span><span class='o'>.</span><span class='nv'>$host</span><span class='o'>.</span><span class='s2'>&quot;&amp;im=&quot;</span><span class='o'>.</span><span class='nv'>$explode</span><span class='p'>[</span><span class='nv'>$i</span><span class='p'>]</span><span class='o'>.</span><span class='s2'>&quot;</span><span class='se'>\&quot;</span><span class='s2'>&gt;&quot;</span><span class='o'>.</span><span class='nv'>$explode</span><span class='p'>[</span><span class='nv'>$i</span><span class='p'>]</span><span class='o'>.</span><span class='s2'>&quot;&lt;/a&gt; &quot;</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='k'>echo</span> <span class='s2'>&quot;&lt;pre&gt;</span><span class='si'>$update_config</span><span class='s2'>&lt;/pre&gt;&quot;</span><span class='p'>;</span>
<span class='cp'>?&gt;</span><span class='x' />


<span class='x'>&lt;form method=&quot;get&quot; action=&quot;index.php&quot;&gt;</span>
<span class='x'>Host:</span>
<span class='x'>&lt;br&gt;&lt;input type=&quot;text&quot; name=&quot;ip&quot; value=&quot;</span><span class='cp'>&lt;?php</span> <span class='k'>echo</span> <span class='s2'>&quot;</span><span class='si'>$host</span><span class='s2'>&quot;</span><span class='p'>;</span><span class='cp'>?&gt;</span><span class='x'>&quot;&gt;&lt;/input&gt;</span>
<span class='x'>&lt;br/&gt;Update Config NSC&lt;br/&gt;</span>
<span class='x'>&lt;select name=&quot;conf&quot;&gt;</span>
<span class='x'>&lt;option value=&quot;&quot;&gt;No&lt;/option&gt;</span>
<span class='x'>&lt;option value=&quot;1&quot;&gt;Yes&lt;/option&gt;</span>
<span class='x'>&lt;/select&gt;</span>

<span class='x'>&lt;!-- &lt;input type=&quot;text&quot; name=&quot;conf2&quot; value=&quot;&quot;&gt;&lt;/input&gt;</span>
<span class='x'>--&gt;</span>
<span class='x'>&lt;br/&gt;&lt;input type=&quot;submit&quot; value=&quot;Show&quot;&gt;</span>
<span class='x'>&lt;/form&gt;</span>
<span class='x'>&lt;br/&gt;</span>
<span class='x'>&lt;a href=&quot;index.php&quot;&gt;refresh page&lt;/a&gt;&lt;br/&gt;</span>
</pre>
</div>
<p>save as <code>index.php</code> and put on your own directory (on example: <code>/usr/local/www/killer/index.php</code> )</p>

<h2 id='last_thing'>Last thing</h2>

<p>just add new link on your side frame nagios webase this html code:</p>
<div class='highlight'><pre><span class='nt'>&lt;tr&gt;</span>                                                    
    <span class='nt'>&lt;td</span> <span class='na'>width=</span><span class='s'>13</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;images/greendot.gif&quot;</span> <span class='na'>width=</span><span class='s'>&quot;13&quot;</span> <span class='na'>height=</span><span class='s'>&quot;14&quot;</span> <span class='na'>name=</span><span class='s'>&quot;tac-dot&quot;</span><span class='nt'>&gt;&lt;/td&gt;</span>
    <span class='nt'>&lt;td</span> <span class='na'>nowrap</span> <span class='na'>width=</span><span class='s'>134</span><span class='nt'>&gt;&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;/apache2-default/index.php&quot;</span> <span class='na'>target=</span><span class='s'>&quot;main&quot;</span> <span class='na'>onMouseOver=</span><span class='s'>&quot;switchdot(&#39;tac-dot&#39;,1)&quot;</span>
<span class='na'>onMouseOut=</span><span class='s'>&quot;switchdot(&#39;tac-dot&#39;,0)&quot;</span> <span class='na'>class=</span><span class='s'>&quot;NavBarItem&quot;</span><span class='nt'>&gt;</span>Process Killer<span class='nt'>&lt;/a&gt;&lt;/td&gt;</span>                                                           
<span class='nt'>&lt;/tr&gt;</span> 
</pre>
</div>
<h2 id='results_look_at_'>Results: look at <a href='http://img69.imageshack.us/img69/986/ssnagios.png' target='_new'>here</a></h2>

<h2 id='reference'>Reference:</h2>
<a href='http://nagios.org' target='_new'>nagios.org</a><br /><a href='http://www.monitoringexchange.org/inventory/Utilities/AddOn-Projects/Communication/NRPE/NRPE' target='_new'>monitor exchange dot org</a><br /><a href='http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/taskkill.mspx?mfr=true' target='_new'>microsoft.com</a><br /><a href='http://technet.microsoft.com/en-us/library/cc725602(WS.10).aspx' target='_new'>technet.microsoft.com</a><br /><a href='http://msdn.microsoft.com/en-us/library/ms681917(v=VS.85).aspx' target='_new'>msdn.microsoft.com</a><br /><a href='http://sourceforge.net/projects/nscplus/files/nscplus/' target='_new'>sf.net</a><br /><a href='http://monitoringforge.org/plugins/esp_frs/file.php?fileid=1974&id=1658&group_id=482&relid=1398&browse_file=y' target='_new'>monitoringforge.org</a>
<h3 id='thanks_to'>Thanks to:</h3>

<ol>
<li>Alit for reference idea.</li>

<li>Marion for explode function</li>

<li>last thanks to netzerospace for took my code again.</li>
</ol>

<p><em>this document specially for development of network monitoring of <a href='http://streetdirectory.co.id' target='_new'>streetdirectory</a> id office</em> and <em>i&#8217;ve tried on debian and freebsd machine for this experiment and successfully</em> :) <br /> <em>happy sysadmin day and happy jobless</em></p>

<p><em>created: djayakarta, finished: djogjakarta 30 July 2010</em></p></span>
</div>
<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
      <li><span>Oct 04 2010</span> &raquo; <a href="/2010/10/04/Make-usb-installer-OpenBSD-4.8.html">Make usb installer OpenBSD 4.8</a></li>
    
      <li><span>Sep 05 2010</span> &raquo; <a href="/2010/09/05/Clustering-Openldap-2.4-dengan-Mirror-Node-Replication-di-CentOs-5.5.html">Clustering Openldap 2.4 dengan Mirror Node Replication di CentOs 5.5</a></li>
    
      <li><span>Jul 14 2010</span> &raquo; <a href="/2010/07/14/upgrade-clamav-di-debian-etch-dengan-backports.html">Upgrade ClamAV di Debian Etch dengan backports</a></li>
    
  </ul>
</div>

<h3 id="archive"><a href="/archive.html">Archive</a></h3>
<br/>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread]
    */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://buildsystem.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=buildsystem">comments powered by Disqus.</a></noscript>

		</div>
	</div>
	<div id="footer">
		<div id="leftcol">
maintenance and developed by <a href="http://deanet.web.id" target="_new">deanet.web.id</a>
</div>

	</div>
</div>
<script type="text/javascript">
//<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
	if(links[i].href.indexOf('#disqus_thread') >= 0) {
		query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
	}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/buildsystem/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
</body>

</html>
