<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>Clustering Openldap 2.4 dengan Mirror Node Replication di CentOs 5.5 &laquo; alinux.web.id</title>
	<meta name="author" content="deanet">
	<link href="atom.xml" rel="alternate" title="build system from God's systems" type="application/atom+xml" />
	<link rel="stylesheet" href="/css/site.css" type="text/css" media="screen, projection" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<meta name="viewport" content="width=850" />
	<link rel="stylesheet" media="screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" />

<script type="text/javascript" src="http://use.typekit.com/aoe6dic.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12495571-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<script type="text/javascript">
        var disqus_awesome = true; 
        var disqus_developer = true;
</script>    
</head>

<body>
<div id="container">
	<div id="header">
		<div id="logo">
	<a class="site" href="/index.html">home</a>
</div>
<div id="navbar">
	<a class="site" href="/atom.xml">rss</a>
</div>

	</div>
	<div id="page">
		<div id="content">
		<div id="post" class="post">
	<span class="title">Clustering Openldap 2.4 dengan Mirror Node Replication di CentOs 5.5</span><br />
	<span class="date">Sep 05 2010</span><br />
	<span class="content"><h2 id='installasi'>Installasi</h2>

<h2 id='barkeley_db_48'>Barkeley DB 4.8</h2>
<div class='highlight'><pre> <span class='nb'>cd</span> /usr/local/src/
 wget -c http://download.oracle.com/berkeley-db/db-4.8.30.tar.gz
 tar -xzvf db-4.8.30.tar.gz
 <span class='nb'>cd </span>db-4.8.30
 <span class='nb'>cd </span>build_unix
 ../dist/configure --prefix<span class='o'>=</span>/usr/local/BerkeleyDB4.8.30
 make clean
 make
 make install
</pre>
</div>
<h3 id='update_ldconfig'>update ldconfig</h3>
<div class='highlight'><pre> <span class='nv'>CPPFLAGS</span><span class='o'>=</span><span class='s2'>&quot;-I/usr/local/BerkeleyDB4.8.30/include&quot;</span>
 <span class='nb'>export </span>CPPFLAGS
 <span class='nv'>LDFLAGS</span><span class='o'>=</span><span class='s2'>&quot;-L/usr/local/lib -L/usr/local/BerkeleyDB4.8.30/lib -R/usr/local/BerkeleyDB4.8.30/lib&quot;</span>
 <span class='nb'>export </span>LDFLAGS
 <span class='nv'>LD_LIBRARY_PATH</span><span class='o'>=</span><span class='s2'>&quot;/usr/local/BerkeleyDB4.8.30/lib&quot;</span>
 <span class='nb'>export </span>LD_LIBRARY_PATH
</pre>
</div>
<h2 id='openldap_24'>openldap 2.4</h2>
<div class='highlight'><pre> <span class='nb'>cd</span> /usr/local/src/
 wget -c ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release/openldap-2.4.23.tgz
 ./configure --prefix<span class='o'>=</span>/usr/local/openldap2.4
 make depend
 make
 make install
</pre>
</div>
<h2 id='konfigurasi'>Konfigurasi:</h2>

<p>file conf:</p>
<div class='highlight'><pre>/usr/local/openldap2.4/etc/openldap/slapd.conf
/usr/local/openldap2.4/etc/openldap/ldap.conf
</pre>
</div>
<h2 id='setup_mirror_node'>SETUP MIRROR NODE</h2>

<p><strong>SERVER1/192.168.11.215:</strong></p>
<div class='highlight'><pre>[user@server1 ~]$ sudo cat /usr/local/openldap2.4/etc/openldap/slapd.conf
#
# See slapd.conf(5) for details on configuration options.
# This file should NOT be world readable.
#
include         /usr/local/openldap2.4/etc/openldap/schema/core.schema
include         /usr/local/openldap2.4/etc/openldap/schema/corba.schema
include         /usr/local/openldap2.4/etc/openldap/schema/cosine.schema
include         /usr/local/openldap2.4/etc/openldap/schema/nis.schema
include         /usr/local/openldap2.4/etc/openldap/schema/inetorgperson.schema

pidfile         /usr/local/openldap2.4/var/run/slapd.pid
argsfile        /usr/local/openldap2.4/var/run/slapd.args

# Load dynamic backend modules:
 modulepath     /usr/local/openldap2.4

#######################################################################
# BDB database definitions
#######################################################################

database        bdb
suffix          &quot;dc=domain-indonesia,dc=com&quot;
rootdn          &quot;cn=admin,dc=domain-indonesia,dc=com&quot;
# Cleartext passwords, especially for the rootdn, should
# be avoid.  See slappasswd(8) and slapd.conf(5) for details.
# Use of strong authentication encouraged.
rootpw          domainldap
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
directory       /usr/local/openldap2.4/var/openldap-data
# Indices to maintain

index objectClass,entryCSN,entryUUID    eq,pres
index ou,cn,mail,surname,givenname      eq,pres,sub
index uidNumber,gidNumber,loginShell    eq,pres
index uid,memberUid                     eq,pres,sub
index nisMapName,nisMapEntry            eq,pres,sub


overlay syncprov
syncprov-checkpoint 100 10
syncprov-sessionlog 100

# Global section
serverID    1
# database section

# syncrepl directive
syncrepl        rid=001
                provider=ldap://192.168.11.216
                bindmethod=simple
                binddn=&quot;cn=admin,dc=domain-indonesia,dc=com&quot;
                credentials=domainldap
                searchbase=&quot;dc=domain-indonesia,dc=com&quot;
                schemachecking=on
                type=refreshAndPersist
                retry=&quot;60 +&quot;
mirrormode on
[user@server1 ~]$
</pre>
</div>
<p><strong>SERVER2/192.168.11.216:</strong></p>
<div class='highlight'><pre>[user@server2 ~]$ sudo cat /usr/local/openldap2.4/etc/openldap/slapd.conf
#
# See slapd.conf(5) for details on configuration options.
# This file should NOT be world readable.
#
include         /usr/local/openldap2.4/etc/openldap/schema/core.schema
include         /usr/local/openldap2.4/etc/openldap/schema/corba.schema
include         /usr/local/openldap2.4/etc/openldap/schema/cosine.schema
include         /usr/local/openldap2.4/etc/openldap/schema/nis.schema
include         /usr/local/openldap2.4/etc/openldap/schema/inetorgperson.schema

pidfile         /usr/local/openldap2.4/var/run/slapd.pid
argsfile        /usr/local/openldap2.4/var/run/slapd.args

# Load dynamic backend modules:
 modulepath     /usr/local/openldap2.4

#######################################################################
# BDB database definitions
#######################################################################

database        bdb
suffix          &quot;dc=domain-indonesia,dc=com&quot;
rootdn          &quot;cn=admin,dc=domain-indonesia,dc=com&quot;

# Cleartext passwords, especially for the rootdn, should
# be avoid.  See slappasswd(8) and slapd.conf(5) for details.
# Use of strong authentication encouraged.
rootpw          domainldap
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
directory       /usr/local/openldap2.4/var/openldap-data
# Indices to maintain

index objectClass,entryCSN,entryUUID    eq,pres
index ou,cn,mail,surname,givenname      eq,pres,sub
index uidNumber,gidNumber,loginShell    eq,pres
index uid,memberUid                     eq,pres,sub
index nisMapName,nisMapEntry            eq,pres,sub


overlay syncprov
syncprov-checkpoint 100 10
syncprov-sessionlog 100

# Global section
serverID    2
# database section

# syncrepl directive
syncrepl        rid=001
                provider=ldap://192.168.11.215
                bindmethod=simple
                binddn=&quot;cn=admin,dc=domain-indonesia,dc=com&quot;
                credentials=domainldap
                searchbase=&quot;dc=domain-indonesia,dc=com&quot;
                schemachecking=on
                type=refreshAndPersist
                retry=&quot;60 +&quot;
mirrormode on

[user@server2 ~]$
</pre>
</div>
<p>debug:</p>
<div class='highlight'><pre>sudo /usr/local/openldap2.4/libexec/slapd -h ldap:/// -u ldap -f /usr/local/openldap2.4/etc/openldap/slapd.conf -d -1
</pre>
</div>
<p>search:</p>
<div class='highlight'><pre>sudo /usr/local/openldap2.4/bin/ldapsearch -x
</pre>
</div>
<p>add:</p>
<div class='highlight'><pre>sudo /usr/local/openldap2.4/bin/ldapadd -x -D <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span> -f /home/user/tes2.ldif -W
</pre>
</div>
<p>delete:</p>
<div class='highlight'><pre>sudo /usr/local/openldap2.4/bin/ldapdelete -D <span class='s2'>&quot;cn=admin,dc=domain-indonesia,dc=com&quot;</span> -w domainldap <span class='s2'>&quot;dc=domain-indonesia,dc=com&quot;</span> <span class='s2'>&quot;ou=Barat,dc=domain-indonesia,dc=com&quot;</span>
</pre>
</div>
<p>Cara mengujinya dengan mengaktifkan ke dua server dalam keadaan debug mode agar terlihat log errornya, lalu tambahkan data di server1 misalnya, terus cek di server 2 apakah automatis terupdate. Jika sudah terupdate lakukan hal yang sama dengan server 2. Seharusnya ke dua server akan tetap sinkronise jika ditambahkan dari kedua nya.</p>

<p>semoga membantu :)</p>

<p>referensi:</p>

<ol>
<li><a href='http://download.oracle.com/docs/cd/E17076_01/html/installation/build_unix.html'>http://download.oracle.com/docs/cd/E17076_01/html/installation/build_unix.html</a></li>

<li><a href='http://s0t4.blogspot.com/2010/05/instalasi-source-openldap-2421-di.html'>http://s0t4.blogspot.com/2010/05/instalasi-source-openldap-2421-di.html</a></li>

<li><a href='http://lists.arthurdejong.org/openldap-technical/2008/09/msg00011.html'>http://lists.arthurdejong.org/openldap-technical/2008/09/msg00011.html</a></li>

<li><a href='http://www.openldap.org/doc/admin24/replication.html'>http://www.openldap.org/doc/admin24/replication.html</a></li>

<li><a href='http://itsecureadmin.com/wiki/index.php/OpenLDAP_Multi-Master_Replication'>http://itsecureadmin.com/wiki/index.php/OpenLDAP_Multi-Master_Replication</a></li>
</ol>

<p>bacaan menarik: <a href='http://www.centos.org/docs/5/html/CDS/ag/8.0/Managing_Replication-Replication_Scenarios.html'>http://www.centos.org/docs/5/html/CDS/ag/8.0/Managing_Replication-Replication_Scenarios.html</a></p></span>
</div>
<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
      <li><span>Oct 04 2010</span> &raquo; <a href="/2010/10/04/Make-usb-installer-OpenBSD-4.8.html">Make usb installer OpenBSD 4.8</a></li>
    
      <li><span>Jul 29 2010</span> &raquo; <a href="/2010/07/29/how-to-kill-windows-process-and-integrated-with-nagios-using-nsclient%2B%2B-on-gnu-linux.html">How to kill windows process and integrated with nagios using Nsclient++ on Gnu/Linux</a></li>
    
      <li><span>Jul 14 2010</span> &raquo; <a href="/2010/07/14/upgrade-clamav-di-debian-etch-dengan-backports.html">Upgrade ClamAV di Debian Etch dengan backports</a></li>
    
  </ul>
</div>

<h3 id="archive"><a href="/archive.html">Archive</a></h3>
<br/>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread]
    */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://buildsystem.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=buildsystem">comments powered by Disqus.</a></noscript>

		</div>
	</div>
	<div id="footer">
		<div id="leftcol">
maintenance and developed by <a href="http://deanet.web.id" target="_new">deanet.web.id</a>
</div>

	</div>
</div>
<script type="text/javascript">
//<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
	if(links[i].href.indexOf('#disqus_thread') >= 0) {
		query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
	}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/buildsystem/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
</body>

</html>
