<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>Install PHP-FPM pada Nginx 0.7.6 dari source &laquo; dhatNyeng</title>
	<meta name="author" content="deanet">
	<link href="atom.xml" rel="alternate" title="build system from God's systems" type="application/atom+xml" />
	<link rel="stylesheet" href="/css/site.css" type="text/css" media="screen, projection" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<meta name="viewport" content="width=850" />
	<link rel="stylesheet" media="screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" />

<script type="text/javascript" src="http://use.typekit.com/aoe6dic.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', '']);
	  _gaq.push(['_trackPageview']);
	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	  })();
	</script>

<script type="text/javascript">
        var disqus_awesome = true; 
        var disqus_developer = true;
</script>    
</head>

<body>
<div id="container">
	<div id="header">
		<div id="logo">
<img src="/images/ashr.gif"><br/>
	<a class="site" href="/index.html">dhatNyeng</a>
</div>
<div id="navbar">
        <a href="/atom.xml"><img src="/images/bt-rss.gif" alt="Subscribe to RSS Feed" border="0" /></a>
                <a href="http://github.com/alinuxwebid/"><img src="/images/smartgit.png" alt="github.com/alinux" border="0" /></a>
</div>

	</div>
	<div id="page">
		<div id="content">
		<div id="post" class="post">
	<span class="title">Install PHP-FPM pada Nginx 0.7.6 dari source</span><br />
	<span class="date">Aug 27 2009</span><br />
	<span class="content"><p>Setelah pada postingan <a href='/2009/08/21/install-nginx-0-7-61-dari-source.html' target='_new'>sebelum nya</a>, menginstall nginx dari source. Pada kali ini kita akan mencoba install PHP-FPM. Mengapa PHP-FPM ??? atau PHP-FPM itu apa sih ?? . baca di <a href='http://interfacelab.com/nginx-php-fpm-apc-awesome/' target='_new'>sini</a> untuk penjelasan lengkapnya.</p>

<p>oke lah. langkah pertama.</p>

<h2 id='compile_php'>Compile PHP:</h2>

<h2 id='donlot_paket_dan_ekstrak'>Donlot paket dan ekstrak</h2>

<pre><code># wget http://id.php.net/get/php-5.3.0.tar.gz/from/this/mirror
# tar -xzvf php-5.3.0.tar.gz
# wget http://php-fpm.org/downloads/php-5.3.0-fpm-0.5.12.diff.gz</code></pre>

<p>Install patch untuk patching php.</p>

<pre><code># zypper install patch</code></pre>

<h2 id='patching_lalu_configure'>Patching lalu configure</h2>

<pre><code># gzip -cd php-5.3.0-fpm-0.5.12.diff.gz | patch -d php-5.3.0 -p1
# cd php-5.3.0/
# ./configure --enable-fastcgi --enable-fpm --with-mcrypt --with-zlib --enable-mbstring --disable-pdo --with-curl --disable-debug --enable-pic --disable-rpath --enable-inline-optimization --with-bz2=/usr/local/sbin --with-xml --with-zlib --enable-sockets --enable-sysvsem --enable-sysvshm --enable-pcntl --enable-mbregex --with-mhash --enable-xslt --enable-memcache --enable-zip --with-pcre-regex</code></pre>

<p><code>make</code>, <code>make test</code> lalu <code>make install</code></p>

<pre><code># make
# make test
# make all install</code></pre>

<p>Setelah sukses make install jalankan perintah berikut:</p>

<pre><code># /usr/local/src/php-5.3.0/build/shtool install -c ext/phar/phar.phar /usr/local/bin
# ln -s -f /usr/local/bin/phar.phar /usr/local/bin/phar</code></pre>

<p>Install module extention via <code>PECL</code></p>

<pre><code># pecl install memcache
# pecl install apc
# pecl install syck-beta</code></pre>

<h2 id='configuration_php'>Configuration PHP:</h2>

<p>Kopi konfigurasi <code>php.ini-production</code> ke <code>/usr/local/lib/php.ini</code></p>

<pre><code># cd ../php-5.3.0/
# cp php.ini-production /usr/local/lib/php.ini</code></pre>

<p>Buat direktori untuk linking konfigurasi php</p>

<pre><code># mkdir /etc/php/</code></pre>

<p>linking <code>php.ini</code> dan <code>php-fpm.conf</code></p>

<pre><code># ln -s /usr/local/lib/php.ini /etc/php/php.ini
# ln -s /usr/local/etc/php-fpm.conf /etc/php/php-fpm.conf</code></pre>

<h2 id='configurasi_phpfpmconf'>Configurasi php-fpm.conf</h2>

<pre><code># vi /etc/php/php-fpm.conf

&lt;value name=&quot;owner&quot;&gt;nobody&lt;/value&gt;
&lt;value name=&quot;group&quot;&gt;nobody&lt;/value&gt;
&lt;value name=&quot;user&quot;&gt;nobody&lt;/value&gt;
&lt;value name=&quot;group&quot;&gt;nobody&lt;/value&gt;</code></pre>

<h2 id='config_nginx'>Config Nginx</h2>

<p>linking direktori conf nginx ke <code>/etc</code></p>

<pre><code># ln -s /usr/local/nginx/conf /etc/nginx</code></pre>

<p>konfigurasi file <code>nginx.conf</code></p>

<pre><code># vi /etc/nginx/nginx.conf</code></pre>

<p>Ketik seperti ini</p>

<pre><code>Liquid error: Broken pipe</code></pre>

<h2 id='konfigurasi_file_fastcgi_params'>Konfigurasi file fastcgi_params</h2>

<p>vi <code>/etc/nginx/fastcgi_params</code></p>

<p>Bikin Script di <code>init.d</code> (RH based)</p>

<p>vi <code>/etc/init.d/nginx</code></p>

<p>ketik seperti ini</p>
<div class='highlight'><pre><span class='c'>#! /bin/sh</span>
<span class='nv'>PATH</span><span class='o'>=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
<span class='nv'>DAEMON</span><span class='o'>=</span>/usr/local/nginx/sbin/nginx
<span class='nv'>NAME</span><span class='o'>=</span>nginx
<span class='nv'>DESC</span><span class='o'>=</span>nginx
<span class='nv'>PIDFILE</span><span class='o'>=</span>/usr/local/nginx/logs/<span class='nv'>$NAME</span>.pid
<span class='nv'>DAEMON_CONFIG</span><span class='o'>=</span>/usr/local/nginx/conf/nginx.conf
    <span class='nb'>test</span> -x <span class='nv'>$DAEMON</span> <span class='o'>||</span> <span class='nb'>exit </span>0
    <span class='nb'>set</span> -e
    <span class='k'>case</span> <span class='s2'>&quot;$1&quot;</span> in
      start<span class='o'>)</span>
            <span class='nb'>echo</span> -n <span class='s2'>&quot;Starting $DESC: &quot;</span>
            start-stop-daemon --start --quiet --pidfile <span class='nv'>$PIDFILE</span> <span class='se'>\</span>
                    --exec <span class='nv'>$DAEMON</span>
            <span class='nb'>echo</span> <span class='s2'>&quot; started&quot;</span>
            ;;
      stop<span class='o'>)</span>
            <span class='nb'>echo</span> -n <span class='s2'>&quot;Stopping $DESC: &quot;</span>
     <span class='k'>if</span> <span class='o'>[</span> -f <span class='nv'>$PIDFILE</span> <span class='o'>]</span>; <span class='k'>then</span>
<span class='k'>                    </span><span class='nb'>kill</span> -15 <span class='sb'>`</span>cat <span class='nv'>$PIDFILE</span> 2&gt;/dev/null<span class='sb'>`</span>
            <span class='k'>fi</span>
<span class='k'>            </span><span class='nb'>echo</span> <span class='s2'>&quot; stopped&quot;</span>
            ;;
      restart|force-reload<span class='o'>)</span>
            <span class='nb'>echo</span> -n <span class='s2'>&quot;Restarting $DESC: &quot;</span>
     <span class='k'>if</span> <span class='o'>[</span> -f <span class='nv'>$PIDFILE</span> <span class='o'>]</span>; <span class='k'>then</span>
<span class='k'>                    </span><span class='nb'>kill</span> -15 <span class='sb'>`</span>cat <span class='nv'>$PIDFILE</span> 2&gt;/dev/null<span class='sb'>`</span>
            <span class='k'>fi</span>
<span class='k'>            </span>sleep 1
            start-stop-daemon --start --quiet --pidfile <span class='nv'>$PIDFILE</span> <span class='se'>\</span>
                    --exec <span class='nv'>$DAEMON</span>
            <span class='nb'>echo</span> <span class='s2'>&quot; restarted&quot;</span>
            ;;
      status<span class='o'>)</span>
            <span class='nb'>echo</span> <span class='s2'>&quot;Status $DESC: &quot;</span>
            ps aux | grep -v grep | grep -v /bin/sh | grep <span class='nv'>$NAME</span>
            ;;
      *<span class='o'>)</span>
            <span class='nv'>N</span><span class='o'>=</span>/etc/init.d/<span class='nv'>$NAME</span>
            <span class='nb'>echo</span> <span class='s2'>&quot;Usage: $N {start|stop|status|restart}&quot;</span> &gt;&amp;2
            <span class='nb'>exit </span>1
            ;;
    <span class='k'>esac</span>
<span class='k'>    </span><span class='nb'>exit </span>0
</pre>
</div>
<h2 id='testing'>Testing:</h2>

<p>Jalankan <code>php-fpm</code></p>

<pre><code># /usr/local/sbin/php-fpm start</code></pre>

<p>lihat apakah sudah running atau belum</p>

<pre><code># netstat -tulpn | grep 9000</code></pre>

<p>Jalankan script nginx</p>

<pre><code># chmod a+x /etc/init.d/nginx
# /etc/init.d/nginx start</code></pre>

<p>lihat apakah sudah running atau belum</p>

<pre><code># netstat -tulpn | grep 80</code></pre>

<p>bikin file <code>index.php</code> di <code>/usr/local/nginx/html/</code> . isi dengan:</p>
<div class='highlight'><pre><span class='x'>	</span><span class='cp'>&lt;?php</span> <span class='nb'>phpinfo</span><span class='p'>();</span> <span class='cp'>?&gt;</span><span class='x' />
</pre>
</div>
<p>Akses ke localhost <code>127.0.0.1</code> atau sesuai alamat ip nya.</p>

<h2 id='troubleshooting'>Troubleshooting:</h2>

<h4 id='a_error_php'>A. ERROR PHP</h4>

<h4 id='1_masalah'>1. Masalah:</h4>

<pre><code>configure: error: XML configuration could not be found</code></pre>

<h4 id='solusi'>Solusi:</h4>

<pre><code># zypper install libxml2-devel</code></pre>

<h4 id='2_masalah'>2. Masalah:</h4>

<pre><code>checking for BZip2 in default path... not found
configure: error: Please reinstall the BZip2 distribution</code></pre>

<h4 id='solusi'>Solusi:</h4>

<p>Install <code>bzip2</code> dari source.</p>

<pre><code># cd ..
# wget http://www.bzip.org/1.0.5/bzip2-1.0.5.tar.gz
# tar -xzvf bzip2-1.0.5.tar.gz
# cd bzip2-1.0.5/
# make
# make install PREFIX=/usr/local/sbin/</code></pre>

<h4 id='3_masalah'>3. Masalah:</h4>

<pre><code>checking for cURL in default path... not found
configure: error: Please reinstall the libcurl distribution -
easy.h should be in /include/curl/</code></pre>

<h4 id='solusi'>Solusi:</h4>

<pre><code>zypper install libcurl-devel libmcrypt-devel mhash-devel</code></pre>

<h2 id='b_memcache'>B. MEMCACHE</h2>

<h5 id='1_masalah'>1. Masalah:</h5>

<pre><code>checking for re2c... no
configure: WARNING: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers.</code></pre>

<h5 id='solusi'>Solusi:</h5>

<pre><code># zypper install re2c</code></pre>

<h5 id='2_masalah'>2. Masalah:</h5>

<pre><code>Configuring for:
PHP Api Version:         20090626
Zend Module Api No:      20090626
Zend Extension Api No:   220090626
Cannot find autoconf. Please check your autoconf installation and the
$PHP_AUTOCONF environment variable. Then, rerun this script.
ERROR: `phpize&#39; failed&lt;/code&gt;</code></pre>

<h4 id='solusi'>Solusi:</h4>

<p>Install autoconf</p>

<pre><code># zypper install autoconf</code></pre>

<p>lalu jalankan lagi <code>pecl install memcache</code></p>

<pre><code>Enable memcache session handler support? [yes] :y &lt;== ketik y</code></pre>

<h4 id='hasil'>Hasil:</h4>

<pre><code>Build process completed successfully
Installing
&#39;/usr/local/lib/php/extensions/no-debug-non-zts-20090626/memcache.so&#39;
install ok: channel://pecl.php.net/memcache-2.2.5
configuration option &quot;php_ini&quot; is not set to php.ini location
You should add &quot;extension=memcache.so&quot; to php.ini&lt;/code&gt;</code></pre>

<h2 id='c_apc'>C. APC</h2>

<h4 id='1_masalah'>1. Masalah:</h4>

<pre><code>Sorry, I was not able to successfully run APXS.  Possible reasons:
1.  Perl is not installed;
2.  Apache was not compiled with DSO support (--enable-module=so);
3.  &#39;apxs&#39; is not in your path.  Try to use --with-apxs=/path/to/apxs
The output of apxs follows
/tmp/pear/temp/APC/configure: line 4061: apxs: command not found
configure: error: Aborting
ERROR: `/tmp/pear/temp/APC/configure --with-apxs&#39; failed
make: *** [php_apc.lo] Error 1&lt;/code&gt;</code></pre>

<h4 id='solusi'>Solusi:</h4>

<pre><code># pecl install apc-beta
Enable per request file info about files used from the APC cache [no] : n &lt;== ketik n
Enable spin locks (EXPERIMENTAL) [no] : n &lt;== ketik n</code></pre>

<h4 id='hasil'>Hasil:</h4>

<pre><code>Build process completed successfully
Installing &#39;/usr/local/lib/php/extensions/no-debug-non-zts-20090626/apc.so&#39;
install ok: channel://pecl.php.net/APC-3.1.3p1
configuration option &quot;php_ini&quot; is not set to php.ini location
You should add &quot;extension=apc.so&quot; to php.ini&lt;/code&gt;</code></pre>

<h2 id='d_syck'>D. SYCK</h2>

<h4 id='1_masalah'>1. Masalah:</h4>

<pre><code>checking for syck files in default path... not found
configure: error: Please reinstall the syck distribution
ERROR: `/tmp/pear/temp/syck/configure&#39; failed&lt;/code&gt;</code></pre>

<h4 id='solusi'>Solusi:</h4>

<p>Install <code>syck</code> dari source.</p>

<pre><code># wget http://files.rubyforge.mmmultiworks.com/syck/syck-0.55.tar.gz
# tar -xzvf syck-0.55.tar.gz
# cd syck-0.55/
# ./configure
# make
# make install</code></pre>

<h4 id='hasil'>Hasil:</h4>

<pre><code>Build process completed successfully
Installing &#39;/usr/local/lib/php/extensions/no-debug-non-zts-20090626/syck.so&#39;
install ok: channel://pecl.php.net/syck-0.9.3
configuration option &quot;php_ini&quot; is not set to php.ini location
You should add &quot;extension=syck.so&quot; to php.ini&lt;/code&gt;</code></pre>

<p>Referensi:</p>

<ol>
<li><a href='http://www.magnet-id.com/download/nginx/nginx-daemon'>Nginx init</a></li>

<li><a href='http://interfacelab.com/nginx-php-fpm-apc-awesome/'>Main Tutorial</a></li>

<li><a href='http://pecl.php.net/bugs/bug.php?id=16078'>APC Error Bug</a></li>

<li><a href='http://labs.uechoco.com/blog/2008/04/phppeclsyck.html'>Syck Error Configuration reinstall</a></li>

<li><a href='http://tunggul.staff.uns.ac.id/2009/01/09/howto-install-eaccelerator-di-freebsd/'>Autoconf</a></li>

<li><a href='http://webhostingneeds.com/Configure:_error:_XML_configuration_could_not_be_found'>XML error</a></li>
</ol></span>
</div>
<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
      <li><span>Jun 30 2010</span> &raquo; <a href="/2010/06/30/installasi-qmail-vpopmail-clamav-simscan-dengan-spamassasin-di-debian-etch.html">Installasi Qmail, Vpopmail, ClamAV, Simscan, Spamassasin di Debian Etch</a></li>
    
      <li><span>Jun 23 2010</span> &raquo; <a href="/2010/06/23/mengatasi-no-public-key-available-di-apt-debian.html">Mengatasi no public key available di apt debian</a></li>
    
      <li><span>Jun 15 2010</span> &raquo; <a href="/2010/06/15/compile-kernel-vs-patch-kernel-on-gnu-linux.html">Compile Kernel VS Patch Kernel on Gnu/Linux</a></li>
    
  </ul>
</div>

<h3 id="archive"><a href="/archive.html">Archive</a></h3>
<br/>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread]
    */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://buildsystem.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=buildsystem">comments powered by Disqus.</a></noscript>

		</div>
	</div>
	<div id="footer">
		<div id="leftcol">
Powered by <a href="http://jekyllrb.com" target="_new">Jekyll</a> and <a href="/credits.html">credits</a>, running on <a href="http://tor.hu" target="_new">Tor Gigabit Connection</a>
</div>
<div id="rightcol">
<a href="/about.html">about</a>
</div>

	</div>
</div>
<script type="text/javascript">
//<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
	if(links[i].href.indexOf('#disqus_thread') >= 0) {
		query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
	}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/buildsystem/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
</body>

</html>
